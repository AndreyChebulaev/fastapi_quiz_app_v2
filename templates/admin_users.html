{% extends "base.html" %}
{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}
{% block content %}
<div class="container">
    <div class="user-info">
        <strong>üë§ {{ user_info.full_name }}</strong>
        <div class="user-details">
            –ì—Ä—É–ø–ø–∞: {{ user_info.group_name }} | 
            –†–æ–ª—å: {{ user_info.user_type }} |
            –õ–æ–≥–∏–Ω: {{ user_info.login }}
        </div>
        <a href="/select">‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–µ—Å—Ç–∞–º</a> | 
        <a href="/logout" style="color: #666; text-decoration: none;">üö™ –í—ã–π—Ç–∏</a>
    </div>

    <h1>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
    
    <div class="user-form">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <form id="addUserForm">
            <div class="form-row">
                <select name="user_type" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                    <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                    <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                    <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                </select>
                <input type="text" name="last_name" placeholder="–§–∞–º–∏–ª–∏—è" required>
                <input type="text" name="first_name" placeholder="–ò–º—è" required>
            </div>
            <div class="form-row">
                <input type="text" name="middle_name" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ">
                <input type="text" name="group_name" placeholder="–ì—Ä—É–ø–ø–∞" required>
                <input type="text" name="login" placeholder="–õ–æ–≥–∏–Ω" required>
            </div>
            <div class="form-row">
                <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button type="submit" class="btn" style="background: #4CAF50; color: white;">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </div>
        </form>
    </div>
    
    <div class="user-list">
        <h3>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ({{ users|length }})</h3>
        {% for user in users %}
        <div class="user-item">
            <div class="user-details">
                <strong>{{ user.full_name }}</strong><br>
                <small>
                    –õ–æ–≥–∏–Ω: {{ user.login }} | 
                    –ü–∞—Ä–æ–ª—å: {{ user.password }} | 
                    –ì—Ä—É–ø–ø–∞: {{ user.group_name }} | 
                    –†–æ–ª—å: {{ user.user_type }} | 
                    –°–æ–∑–¥–∞–Ω: {{ user.created_at }}
                </small>
            </div>
            <button onclick="deleteUser({{ user.id }})" class="btn btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
        {% endfor %}
    </div>

    <script>
        document.getElementById('addUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            const response = await fetch('/admin/add_user', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            alert(result.message);
            
            if (result.status === 'success') {
                location.reload();
            }
        });

        async function deleteUser(userId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                const formData = new FormData();
                formData.append('user_id', userId);
                
                const response = await fetch('/admin/delete_user', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                alert(result.message);
                
                if (result.status === 'success') {
                    location.reload();
                }
            }
        }
    </script>
</div>
{% endblock %}