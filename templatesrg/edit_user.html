{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
    
    <form method="post" action="/v2/users/{{ user.id }}/update" class="edit-form">
        <div class="form-row">
            <div class="form-group">
                <label for="last_name">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" required class="form-input">
            </div>
            
            <div class="form-group">
                <label for="first_name">–ò–º—è:</label>
                <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" required class="form-input">
            </div>
            
            <div class="form-group">
                <label for="middle_name">–û—Ç—á–µ—Å—Ç–≤–æ:</label>
                <input type="text" id="middle_name" name="middle_name" value="{{ user.middle_name or '' }}" class="form-input">
            </div>
        </div>

        {% if user.user_type == 'student' %}
        <div class="form-group">
            <label for="group_name">–ì—Ä—É–ø–ø–∞:</label>
            <input type="text" id="group_name" name="group_name" value="{{ user.group_name or '' }}" class="form-input">
        </div>
        {% endif %}

        <div class="form-group">
            <label for="login">–õ–æ–≥–∏–Ω:</label>
            <input type="text" id="login" name="login" value="{{ user.login }}" required class="form-input">
        </div>

        <div class="form-group">
            <label for="password">–ü–∞—Ä–æ–ª—å:</label>
            <div class="password-field">
                <input type="password" id="password" name="password" value="{{ user.password }}" required class="form-input">
                <button type="button" class="btn-password-toggle" onclick="togglePassword()">üëÅÔ∏è</button>
                <button type="button" class="btn-regenerate-password" onclick="regeneratePassword({{ user.id }})">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π</button>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <a href="/v2/users" class="btn btn-cancel">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
function togglePassword() {
    const passwordField = document.getElementById('password');
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
    } else {
        passwordField.type = 'password';
    }
}

function regeneratePassword(userId) {
    if (confirm('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å? –°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω.')) {
        fetch(`/v2/users/${userId}/regenerate_password`, {
            method: 'POST'
        }).then(response => {
            if (response.ok) {
                location.reload();
            }
        });
    }
}
</script>
{% endblock %}